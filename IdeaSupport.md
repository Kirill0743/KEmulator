# Поддержка IntelliJ IDEA

Отличие J2ME "MIDP/CLDC" от J2SE по сути, написано в названии: это другая стдлиба и более "слабая" версия языка. Теоретически, любую имплементацию JRE можно запускать любым отладчиком, пока они реализуют протокол отладки по спецификации. Ещё больше задача упрощается тем что кемулятор работает поверх обычного хотспота из 1.8. Таким образом, задача запуска/сборки проекта под кемулятором из IDE ничего не знающей про J2ME сводится к простановке корректного "корневого" (и не-"корневого") класспатча.

Поскольку ручная настройка занимает 20 шагов не очевидного ползания по менюшкам и вбивания туда ещё более не очевидных вещей (и периодически слетает при перезапуске IDE если она заподозрила что ваша JDK 1.8 не совсем J2SEDK и не совсем 1.8), было принято решение сделать мастер настройки который спросит у юзера где у него что лежит и сам впишет нужное в конфиг идеи.

Ниже содержится вольное объяснение что вообще происходит. Документ будет дополняться по мере затуманивания моей памяти.

## Devtime-JDK

При разработке IDE должна забыть про стдлибу J2SEDK 1.8 и вместо этого предлагать программисту подсказки по мешной стдлибе. Это достигается удалением стандартного корневого класспатча и добавлением в него всего содержимого папки uei. Библиотеки тут не имеют реализаций, только пустые объявления, но для работы автодополнений/поисков/рефакторинга/компиляции этого достаточно. Запуститься проект в таких условиях, разумеется, не сможет, но оно и не нужно.

## Runtime-JDK

В корневом класспатче оставляется J2SEDK 1.8, т.к. кемулятор реализован поверх неё. Так же в корневой добавляются жарники самого кемулятора, т.к. он должен загрузиться до загрузки классов проекта. Это необходимо для корректного срабатывания переопределений методов (например, CLDCшный util.Timer работает отлично от J2SEшного, кемулятор поставляет собственную имплементацию и заменяет ей системную). В основной класспатч добавляется сам проект.

В качестве точки входа указывается main() в жарнике кемулятора - на момент пуска проекта он уже загружен и хотспот  не замечает подвоха. В аргументы кемулятору передаётся путь к жаду и класспатчу из которого грузится проект - это нужно для корректной установки хуков чтения ресурсов и пропертисов.

Получившаяся вундервафля не только не теряет ресурсы, но даже и поддерживает горячую перезагрузку, разумеется, намного грустнее девятого дотнета, но вполне рабоче.

## Жавадоки

По хорошему, должны лежать в ./uei/javadocs, там, где их ожидает эклипс. Поскольку они там, разумеется, не лежат, юзеру предлагается самостоятельно скачать говносборку Никиты, куда-то её распаковать и отдать конфигуратору путь. Из этих путей будут надёрганы подходящие подпути и проставлены в Devtime-jdk.

## Преверификация?

Разумеется, IDEA не знает что это. К счастью, хотспот тоже - поэтому сборка и отладка проекта будет работать и так. Для упаковки под телефон понадобится прогард, который умеет её делать. Реализовано в виде "конфигурации запуска", где в среду runtime-jdk подкидывается жарник прогарда и ему указывается что делать. Конфигуратор предлагает сам докачать в папку кемуля либо куда-то в /opt/.